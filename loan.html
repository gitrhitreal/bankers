<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: Arial,sans-serif; background: linear-gradient(135deg,#74ABE2,#5563DE); }
    header { background: rgba(255,255,255,0.15); padding: 20px; color: #fff; text-align: center; font-size: 24px; font-weight: bold; }
    #loanList { margin: 40px auto; max-width: 800px; display: grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 20px; }
    .loan-card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.15); text-align: center; cursor: pointer; }
    .loan-title { font-weight:bold; margin-bottom:10px; color:#333; }
    .loan-details { margin-bottom:15px; color:#555; }
    .approve-btn { padding:10px 15px; border:none; background:#5563DE; color:#fff; font-weight:bold; border-radius:8px; cursor:pointer; }
    .approve-btn:hover { background:#3340b8; }
  </style>
</head>
<body>
  <header>Available Loan Portfolios</header>
  <div id="loanList">Loading loans...</div>

  <script>
    const bankName = prompt("Enter your bank name (must match sheet exactly):");
    const userId = prompt("Enter your user ID:");

    function loadLoans() {
      google.script.run.withSuccessHandler(renderLoans).getLoans();
    }

    function renderLoans(loans) {
      const loanList = document.getElementById("loanList");
      loanList.innerHTML = "";

      const filtered = loans.filter(l => l.Bank === bankName);

      if (filtered.length === 0) {
        loanList.innerHTML = "<p style='color:white;'>No loans available for your bank.</p>";
        return;
      }

      filtered.forEach(loan => {
        const card = document.createElement("div");
        card.className = "loan-card";
        card.innerHTML = `
          <div class="loan-title">${loan["Loan Name"]}</div>
          <div class="loan-details">Amount: ${loan.Amount}</div>
          <div class="loan-details">Tenure: ${loan.Tenure}</div>
          <div class="loan-details">Interest: ${loan.Interest}</div>
          <button class="approve-btn">Approve</button>
        `;
        card.querySelector(".approve-btn").onclick = () => {
          google.script.run.withSuccessHandler(success => {
            if (success) {
              alert(`Loan "${loan["Loan Name"]}" approved!`);
              loadLoans();
            } else {
              alert("Error approving loan");
            }
          }).approveLoan(bankName, loan["Loan Name"], userId);
        };
        loanList.appendChild(card);
      });
    }

    loadLoans();
  </script>
</body>
</html>
